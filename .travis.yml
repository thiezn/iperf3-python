language: python
os: linux
sudo: required
dist: trusty
python:
    - "2.6"
    - "2.7"
    - "3.3"
    - "3.4"
    - "3.5"
    - "3.5-dev"
    - "nightly"
env:
  - IPERF_VERSION="3.0.1"
  - IPERF_VERSION="3.0.2"
  - IPERF_VERSION="3.0.3"
  - IPERF_VERSION="3.0.4"
  - IPERF_VERSION="3.0.5"
  - IPERF_VERSION="3.0.6"
  - IPERF_VERSION="3.0.7"
  - IPERF_VERSION="3.0.8"
  - IPERF_VERSION="3.0.9"
  - IPERF_VERSION="3.0.10"
  - IPERF_VERSION="3.0.11"
  - IPERF_VERSION="3.0.12"
  - IPERF_VERSION="3.1"
  - IPERF_VERSION="3.1.1"
  - IPERF_VERSION="3.1.2"
  - IPERF_VERSION="3.1.3"
before_install:
    # Download the various available iperf3 sources
    - if [[ "$IPERF_VERSION" == "3.0.1" ]]; then wget https://iperf.fr/download/source/iperf-3.0.1-source.tar.gz ;fi
    - if [[ "$IPERF_VERSION" == "3.0.2" ]]; then wget https://iperf.fr/download/source/iperf-3.0.2-source.tar.gz ;fi
    - if [[ "$IPERF_VERSION" == "3.0.3" ]]; then wget https://iperf.fr/download/source/iperf-3.0.3-source.tar.gz ;fi
    - if [[ "$IPERF_VERSION" == "3.0.4" ]]; then wget https://iperf.fr/download/source/iperf-3.0.4-source.tar.gz ;fi
    - if [[ "$IPERF_VERSION" == "3.0.5" ]]; then wget https://iperf.fr/download/source/iperf-3.0.5-source.tar.gz ;fi
    - if [[ "$IPERF_VERSION" == "3.0.6" ]]; then wget https://iperf.fr/download/source/iperf-3.0.6-source.tar.gz ;fi
    - if [[ "$IPERF_VERSION" == "3.0.7" ]]; then wget https://iperf.fr/download/source/iperf-3.0.7-source.tar.gz ;fi
    - if [[ "$IPERF_VERSION" == "3.0.8" ]]; then wget https://iperf.fr/download/source/iperf-3.0.8-source.tar.gz ;fi
    - if [[ "$IPERF_VERSION" == "3.0.9" ]]; then wget https://iperf.fr/download/source/iperf-3.0.9-source.tar.gz ;fi
    - if [[ "$IPERF_VERSION" == "3.0.10" ]]; then wget https://iperf.fr/download/source/iperf-3.0.10-source.tar.gz ;fi
    - if [[ "$IPERF_VERSION" == "3.0.11" ]]; then wget https://iperf.fr/download/source/iperf-3.0.11-source.tar.gz ;fi
    - if [[ "$IPERF_VERSION" == "3.0.12" ]]; then wget https://iperf.fr/download/source/iperf-3.0.12-source.tar.gz ;fi
    - if [[ "$IPERF_VERSION" == "3.1" ]]; then wget https://iperf.fr/download/source/iperf-3.1-source.tar.gz ;fi
    - if [[ "$IPERF_VERSION" == "3.1.1" ]]; then wget https://iperf.fr/download/source/iperf-3.1.1-source.tar.gz ;fi
    - if [[ "$IPERF_VERSION" == "3.1.2" ]]; then wget https://iperf.fr/download/source/iperf-3.1.2-source.tar.gz ;fi
    - if [[ "$IPERF_VERSION" == "3.1.3" ]]; then wget https://iperf.fr/download/source/iperf-3.1.3-source.tar.gz ;fi
    # Install iperf version selected above
    - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then tar xvf iperf-*-source.tar.gz ;fi
    - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then cd iperf-*/ ;fi
    - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then ./bootstrap.sh ;fi
    - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then ./configure && make && make install ;fi
    - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then cd .. ;fi
      #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get update -qq ;fi
      #- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get install -y iperf3 ;fi
    # Install iperf3, python3 and activate venv for osx
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then git clone https://github.com/esnet/iperf.git ;fi
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then cd iperf ;fi
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then ./bootstrap.sh ;fi
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then ./configure && make && make install ;fi
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then cd .. ;fi
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update ;fi
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install python3 ;fi
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then virtualenv venv -p python3 ;fi
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then source venv/bin/activate ;fi
install: 
    - "pip install -r requirements.txt"
    - "pip install coverage"
    - "pip install coveralls"
script: 
    - "coverage run --source=iperf3 setup.py test"
after_success:
    coveralls
